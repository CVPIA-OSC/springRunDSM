library(tidyverse)
library(springRunDSM)
source('data-raw/load-old-inputs.R')

sim <- spring_run_model(seeds = old_seeds, stochastic = FALSE,
                        mode = "simulate", ..params = params)

v1.1 <- sim$spawners
v1.0 <- v1.0_decay
v1.0 <- v1.0_no_decay

# cbind(v1.1, v1.0, (v1.1-v1.0)/v1.0)
# summary((v1.1-v1.0)/v1.0)

all_data <- bind_rows(
  as_tibble(v1.1) %>% 
    mutate(watershed = DSMscenario::watershed_labels) %>% 
    gather(year, spawners, -watershed) %>% 
    mutate(year = as.numeric(year), version = '1.1'),
  as_tibble(v1.0) %>% 
    mutate(watershed = DSMscenario::watershed_labels) %>% 
    gather(year, spawners, -watershed) %>% 
    mutate(year = parse_number(year), version = '1.0')
)

all_data %>% 
  ggplot(aes(year, spawners, color = version)) +
  geom_line() +
  facet_wrap(~watershed, scales = "free_y")

tibble(year = 1:20,
       v1.1, v1.0) %>% 
  gather(scenario, spawners, - year) %>% 
  ggplot(aes(year, spawners, color = scenario)) +
  geom_line() +
  scale_x_continuous(breaks = 1:20) +
  ylim(c(0,9000))

(mean(v1.1) - mean(v1.0))/mean(v1.0)

v1.0_both <- bind_rows(
  as_tibble(v1.0_no_decay) %>% 
    mutate(watershed = DSMscenario::watershed_labels) %>% 
    gather(year, spawners, -watershed) %>% 
    mutate(year = parse_number(year), decay = FALSE),
  as_tibble(v1.0_decay) %>% 
    mutate(watershed = DSMscenario::watershed_labels) %>% 
    gather(year, spawners, -watershed) %>% 
    mutate(year = parse_number(year), decay = TRUE)
)

v1.0_both %>% 
  ggplot(aes(year, spawners, color = decay)) +
  geom_line() +
  facet_wrap(~watershed, scales = "free_y")

v1.0_no_decay <- structure(c(42.6547296715518, 86.3523437645126, 409.330245159721, 
                             0, 46.9802075161596, 11452.4842294936, 778.292843432227, 43.1669573110448, 
                             0, 545.041695460445, 0, 690.378659594213, 0, 0, 42.6547296715518, 
                             0, 0, 0, 6008.09410645565, 842.606719511106, 0, 0, 0, 0, 42.7583299775039, 
                             42.7583299775039, 42.7583299775039, 42.7620791406661, 42.7620791406661, 
                             42.7620791406661, 0, 39.5235925127828, 80.0387432174961, 337.913779999419, 
                             0, 43.8490703573906, 10430.9556616253, 721.786682978289, 40.0358201522758, 
                             0, 440.736426555971, 0, 611.279806906162, 0, 0, 39.5235925127828, 
                             0, 0, 0, 6440.84277336404, 833.36779942875, 0, 0, 0, 0, 39.6195878762085, 
                             39.6195878762085, 39.6195878762085, 39.6230618261839, 39.6230618261839, 
                             39.6230618261839, 0, 31.8870317214397, 65.9630154054699, 320.525487870728, 
                             0, 36.2157981452009, 8669.37141410163, 520.006332861058, 32.4196960882731, 
                             0, 379.864300146514, 0, 477.084829855399, 0, 0, 31.866865704776, 
                             0, 0, 0, 5631.2326358991, 806.506501462609, 0, 0, 0, 0, 31.9412854248349, 
                             31.9412854248349, 31.9412854294156, 31.9440861209971, 31.9441885417298, 
                             31.9442950299827, 0, 29.9081744529664, 65.5307490627937, 386.015582643647, 
                             0, 34.2505994939031, 8159.6804485365, 428.3245109139, 30.6457177605065, 
                             0, 392.255518508962, 0, 650.533515704111, 0, 0, 29.8587769444474, 
                             0, 0, 0, 5140.21047864654, 795.850582123845, 0, 0, 0, 0, 29.914039865188, 
                             29.914039865188, 29.9140422225729, 29.9166628071119, 29.9169285533162, 
                             29.9172268687006, 0, 38.1227911514314, 84.2855920069512, 466.111560376778, 
                             0, 42.4835839985482, 10064.9575875566, 633.083994019873, 39.0161194516606, 
                             0, 463.484041862251, 0, 875.87389528115, 0, 0, 38.0609418999928, 
                             0, 0, 0, 5503.64236137579, 831.90679224055, 0, 0, 0, 0, 38.1245055178828, 
                             38.1245055178828, 38.1245153686996, 38.1278483750931, 38.1298939551472, 
                             38.1297965685319, 0, 44.5346713947979, 95.986201669414, 402.663153068284, 
                             0, 48.8861728669546, 11683.3755566527, 782.803256514293, 45.3069397107134, 
                             0, 421.375136829809, 0, 803.42966039949, 0, 0, 44.4659132935581, 
                             0, 0, 0, 6431.83216458996, 856.137734709038, 0, 0, 0, 0, 44.5506139600679, 
                             44.5506139600679, 44.5506286143684, 44.5545202754175, 44.5596529483683, 
                             44.5584132279343, 0, 44.2160723961433, 94.7257084018608, 329.765499754659, 
                             0, 48.5442018463114, 11103.7429348293, 733.031764292486, 44.9041164598799, 
                             0, 364.779277491741, 0, 742.187057347984, 0, 0, 44.1646432521087, 
                             0, 0, 0, 6927.34404608026, 853.972668435035, 0, 0, 0, 0, 44.2571018705477, 
                             44.2571018705477, 44.2571135918234, 44.260982449983, 44.2660712261894, 
                             44.2642217181183, 0, 34.9989776029754, 77.3146261004119, 298.317457339819, 
                             0, 39.3474021453029, 9775.2014851399, 620.016840440653, 35.6025805678204, 
                             0, 337.496718109511, 0, 587.486139690735, 0, 0, 34.9557980132883, 
                             0, 0, 0, 5886.84450102395, 824.285969734721, 0, 0, 0, 0, 35.0288203756346, 
                             35.0288203756346, 35.028850792201, 35.0318917950058, 35.0347308529489, 
                             35.0330888743261, 0, 32.274554269654, 72.3697866625606, 285.396191272985, 
                             0, 36.6530474264973, 8966.26442928192, 574.53366155352, 32.8494735583925, 
                             0, 302.843290389805, 0, 534.808172482469, 0, 0, 32.2164052632835, 
                             0, 0, 0, 5030.90478885155, 796.334944198071, 0, 0, 0, 0, 32.2824340055548, 
                             32.2824340055548, 32.282483156303, 32.2852646145244, 32.2882685687619, 
                             32.2860641116712, 0, 31.6615740165266, 70.3801125911186, 299.944502335069, 
                             0, 36.0203421814208, 8685.27543769824, 564.028511835196, 32.3741492204173, 
                             0, 260.068451783825, 0, 620.612853816452, 0, 0, 31.6179342490128, 
                             0, 0, 0, 5012.86505637139, 783.414157443425, 0, 0, 0, 0, 31.6849059668467, 
                             31.6849059668467, 31.684929272475, 31.6876841829817, 31.6919868120678, 
                             31.6886377355672, 0, 29.5264130168379, 65.2903814533591, 288.569325906822, 
                             0, 33.8590509316934, 8552.9565902381, 532.748724142342, 30.2489138212997, 
                             0, 231.938276803962, 0, 521.993408856007, 0, 0, 29.5010553435908, 
                             0, 0, 0, 4990.35244063325, 769.798184248079, 0, 0, 0, 0, 29.566566639976, 
                             29.566566639976, 29.5665666468867, 29.569159114531, 29.5733026150211, 
                             29.5696376206689, 0, 28.2703410525056, 62.6546018903876, 263.242893400486, 
                             0, 32.6015577896243, 7889.84581280974, 517.223087841866, 28.9572511868106, 
                             0, 223.913281717945, 0, 456.803881460254, 0, 0, 28.2473186977761, 
                             0, 0, 0, 4982.33136893617, 757.2431943702, 0, 0, 0, 0, 28.3110253513173, 
                             28.3110253513173, 28.311025351924, 28.3135077367002, 28.3171847140504, 
                             28.3136192888771, 0, 28.2407834619963, 62.1771806973964, 277.997984815251, 
                             0, 32.5708246377541, 7845.27760708153, 494.61541035431, 28.954982457126, 
                             0, 203.819011358529, 0, 516.324703341462, 0, 0, 28.2159736130982, 
                             0, 0, 0, 4977.37060117828, 757.291820699516, 0, 0, 0, 0, 28.2802394487008, 
                             28.2802394487008, 28.2802394489685, 28.2827191346945, 28.2878634006775, 
                             28.2829071202284, 0, 33.2482202970983, 71.9590175127448, 300.064421196717, 
                             0, 37.5895004665671, 9868.34796863947, 478.879181836163, 33.8583778954829, 
                             0, 202.389019061741, 0, 414.403585317701, 0, 0, 33.2239922225097, 
                             0, 0, 0, 4985.2434907783, 767.826411086296, 0, 0, 0, 0, 33.300225833294, 
                             33.300225833294, 33.3002258335187, 33.3031456849359, 33.3089972595752, 
                             33.303457788445, 0, 37.1194372997653, 79.9613920838973, 322.938301279055, 
                             0, 41.4753705525465, 11259.4704594887, 483.112646516319, 37.6211169283269, 
                             0, 217.810864453746, 0, 325.755821692126, 0, 0, 37.0882836388621, 
                             0, 0, 0, 5002.82962210319, 773.312131369711, 0, 0, 0, 0, 37.1726188424823, 
                             37.1726188424823, 37.1726188438342, 37.175878235758, 37.1785682992365, 
                             37.1761531463345, 0, 33.5419930142481, 73.1670122677914, 341.059708789654, 
                             0, 37.8853916606504, 9861.13313675906, 470.320800295365, 34.0286540437963, 
                             0, 213.700423783647, 0, 335.131132725378, 0, 0, 33.4948998259047, 
                             0, 0, 0, 5007.60845909549, 768.775314881747, 0, 0, 0, 0, 33.5700908981978, 
                             33.5700908981978, 33.5700910597544, 33.5730344123205, 33.573494634729, 
                             33.5732205236811, 0, 29.1794787051483, 64.8427457869978, 311.600430631685, 
                             0, 33.5021065438511, 8576.0862851569, 451.111099192615, 29.6575627353239, 
                             0, 201.739540941795, 0, 264.240988975404, 0, 0, 29.1113051101832, 
                             0, 0, 0, 5027.71325752967, 763.322036592301, 0, 0, 0, 0, 29.1757555251994, 
                             29.1757555251994, 29.1757590455521, 29.1783137324049, 29.1789422921469, 
                             29.1785182860891, 0, 31.8642252134227, 70.1102740292164, 321.437499410578, 
                             0, 36.1808367086599, 9291.57364399642, 512.870059600997, 32.409375692487, 
                             0, 204.899433853528, 0, 293.46107381858, 0, 0, 31.7626388545641, 
                             0, 0, 0, 5117.81416899825, 769.201049654762, 0, 0, 0, 0, 31.8288251837137, 
                             31.8288251837137, 31.8288338618779, 31.8316160190653, 31.832022149068, 
                             31.8319214620211, 0, 31.360891074306, 68.6604172590457, 322.064482037786, 
                             0, 35.6720587460429, 8870.46147626103, 587.860756569075, 31.9645585481282, 
                             0, 204.211312643125, 0, 335.095806290392, 0, 0, 31.250500538974, 
                             0, 0, 0, 5402.30220585034, 767.387912079086, 0, 0, 0, 0, 31.3129728000197, 
                             31.3129728000197, 31.3129862451501, 31.3157184040736, 31.3168212638097, 
                             31.3171282767537, 0, 24.3364016883753, 54.4807064288631, 240.913741110352, 
                             0, 28.6432611713745, 6533.08945949558, 599.001144035417, 24.8523067655203, 
                             0, 195.954601687812, 0, 238.176708293641, 0, 0, 24.2269482261009, 
                             0, 0, 0, 5592.53031955682, 752.668557715691, 0, 0, 0, 0, 24.2747693335469, 
                             24.2747693335469, 24.2748466901567, 24.2768978093551, 24.2790780531658, 
                             24.2797324865729, 0), .Dim = c(31L, 20L))
v1.0_decay <- structure(c(42.6547296715518, 86.3523437645126, 409.330245159721, 
                          0, 46.9802075161596, 11452.4842294936, 778.292843432227, 43.1669573110448, 
                          0, 545.041695460445, 0, 690.378659594213, 0, 0, 42.6547296715518, 
                          0, 0, 0, 6008.09410645565, 842.606719511106, 0, 0, 0, 0, 42.7583299775039, 
                          42.7583299775039, 42.7583299775039, 42.7620791406661, 42.7620791406661, 
                          42.7620791406661, 0, 39.5235925127828, 80.0387432174961, 337.913779999419, 
                          0, 43.8490703573906, 10430.9556616253, 721.786682978289, 40.0358201522758, 
                          0, 440.736426555971, 0, 611.279806906162, 0, 0, 39.5235925127828, 
                          0, 0, 0, 6440.84277336404, 833.36779942875, 0, 0, 0, 0, 39.6195878762085, 
                          39.6195878762085, 39.6195878762085, 39.6230618261839, 39.6230618261839, 
                          39.6230618261839, 0, 31.8870317214397, 65.9630154054699, 320.525487870728, 
                          0, 36.2157981452009, 8669.37141410163, 520.006332861058, 32.4196960882731, 
                          0, 379.864300146514, 0, 477.084829855399, 0, 0, 31.866865704776, 
                          0, 0, 0, 5631.2326358991, 806.506501462609, 0, 0, 0, 0, 31.9412854248349, 
                          31.9412854248349, 31.9412854294156, 31.9440861209971, 31.9441885417298, 
                          31.9442950299827, 0, 29.9170377952523, 65.5515240974077, 386.022204867831, 
                          0, 34.2594628371876, 8163.35826622156, 427.624858992459, 30.6543137861868, 
                          0, 392.450241731014, 0, 650.341533418557, 0, 0, 29.8676182967613, 
                          0, 0, 0, 5140.22428774868, 795.868286100947, 0, 0, 0, 0, 29.9229133535518, 
                          29.9229133535518, 29.9229157109367, 29.9255370735266, 29.9258028197308, 
                          29.9261011351152, 0, 38.1316802936261, 84.3094645455581, 466.107126924016, 
                          0, 42.4924730936588, 10072.2958620073, 628.769230083773, 39.024474042703, 
                          0, 463.855696599908, 0, 875.472639301882, 0, 0, 38.0697870366243, 
                          0, 0, 0, 5503.65619294469, 831.924525021198, 0, 0, 0, 0, 38.1333934429993, 
                          38.1333934429993, 38.1334032938161, 38.1367370795264, 38.1387826595804, 
                          38.1386852729651, 0, 44.5025019675442, 95.9239496907532, 402.570573596609, 
                          0, 48.8539968783336, 11684.1707334782, 771.256550751753, 45.2745253539416, 
                          0, 421.455136297143, 0, 803.131482261088, 0, 0, 44.4336887691435, 
                          0, 0, 0, 6431.80097403804, 856.0892072556, 0, 0, 0, 0, 44.5183278801985, 
                          44.5183278801985, 44.5183425350942, 44.5222313646195, 44.5273644611406, 
                          44.5261245696681, 0, 44.146051341225, 94.5842338922826, 329.591289970658, 
                          0, 48.4741689475921, 11097.9988077342, 715.001036483759, 44.8341400535065, 
                          0, 364.621568163889, 0, 741.964388874101, 0, 0, 44.0945553082221, 
                          0, 0, 0, 6927.27246138316, 853.864684246029, 0, 0, 0, 0, 44.1868556158618, 
                          44.1868556158618, 44.1868673389244, 44.1907300359202, 44.1958197550199, 
                          44.193969829866, 0, 35.0092800182692, 77.3334128898334, 298.138885595686, 
                          0, 39.3582932444062, 9774.78723364749, 597.83800002048, 35.6043259788911, 
                          0, 337.678545620838, 0, 584.007126349194, 0, 0, 34.9640381179653, 
                          0, 0, 0, 5886.87644009134, 862.733544114637, 0, 0, 0, 0, 35.0371294261965, 
                          35.0371294261965, 35.0371598276703, 35.0402015741271, 35.0430408175729, 
                          35.0413988269612, 0, 32.3904976371846, 72.6117172405864, 285.261744830994, 
                          0, 36.7701652143364, 8984.76706508903, 546.999821348884, 32.942961477081, 
                          0, 303.673473887763, 0, 522.804160773152, 0, 0, 32.3282855680239, 
                          0, 0, 0, 5031.07917879196, 893.777346954822, 0, 0, 0, 0, 32.3946800232705, 
                          32.3946800232705, 32.3947291408443, 32.397520474267, 32.4005208895144, 
                          32.3983191530178, 0, 31.8099408803782, 70.7161961579208, 299.925792783859, 
                          0, 36.169301933541, 8741.37438416675, 531.385050012172, 32.4965023635807, 
                          0, 261.559135479803, 0, 599.038871291723, 0, 0, 31.764166291692, 
                          0, 0, 0, 5013.09620564798, 868.143591520172, 0, 0, 0, 0, 31.8316332624809, 
                          31.8316332624809, 31.8316565512095, 31.8344243440523, 31.8387212034599, 
                          31.835376588128, 0, 29.6250493394868, 65.5352376527761, 288.545354015434, 
                          0, 33.9577545214272, 8619.50182564884, 496.182585950782, 30.32852280228, 
                          0, 233.382202604754, 0, 500.567171400943, 0, 0, 29.5994571043298, 
                          0, 0, 0, 4990.39976199215, 805.89700681845, 0, 0, 0, 0, 29.6653716122208, 
                          29.6653716122208, 29.6653716191223, 29.6679727502564, 29.6721172050687, 
                          29.6684507955015, 0, 28.2698404899983, 62.7102334052361, 263.125938940494, 
                          0, 32.6010984402771, 7946.08688844285, 476.035897870122, 28.9391947551428, 
                          0, 225.251193224056, 0, 429.015593924436, 0, 0, 28.2464947151294, 
                          0, 0, 0, 4982.15485030826, 776.077111422071, 0, 0, 0, 0, 28.3103104203885, 
                          28.3103104203885, 28.3103104209962, 28.3127927430843, 28.3164806334166, 
                          28.3129045842286, 0, 28.23305297572, 62.23364976002, 277.90223726364, 
                          0, 32.5630354209101, 7902.84504220499, 450.575744815861, 28.9258472641274, 
                          0, 205.500376885759, 0, 476.22091538791, 0, 0, 28.2078551824537, 
                          0, 0, 0, 4977.24633649178, 803.142473322688, 0, 0, 0, 0, 28.2721751614739, 
                          28.2721751614739, 28.2721751617428, 28.2746541403697, 28.2798179984113, 
                          28.2748427804908, 0, 33.2068504891259, 71.9133590217318, 300.029623425999, 
                          0, 37.5482429337599, 9891.55074244604, 432.560462407452, 33.8064402105509, 
                          0, 203.449092015782, 0, 388.360663842375, 0, 0, 33.1824266696187, 
                          0, 0, 0, 4985.03155735933, 852.427232178044, 0, 0, 0, 0, 33.2585687040042, 
                          33.2585687040042, 33.2585687042294, 33.2614849030391, 33.267356787258, 
                          33.2617979560374, 0, 37.1807139046197, 80.0640866337793, 323.507136628267, 
                          0, 41.5371861180857, 11230.7718907178, 428.605861841353, 37.6825431179092, 
                          0, 218.227743466614, 0, 311.751745168462, 0, 0, 37.1492837035818, 
                          0, 0, 0, 5002.81001760441, 925.566290021218, 0, 0, 0, 0, 37.233661104378, 
                          37.233661104378, 37.2336611057296, 37.2369258500002, 37.2396240045431, 
                          37.2372011928934, 0, 33.6552504199256, 73.3485064091848, 341.891744568811, 
                          0, 37.9993330878785, 9813.69740925217, 396.057922515455, 34.1418395248075, 
                          0, 213.92996451603, 0, 317.897292482266, 0, 0, 33.6075792114938, 
                          0, 0, 0, 5007.74963344525, 1018.39431383197, 0, 0, 0, 0, 33.682908266494, 
                          33.682908266494, 33.6829084278509, 33.6858616727411, 33.6863215316292, 
                          33.6860477371593, 0, 29.3479110967424, 65.1536056926557, 312.430874672586, 
                          0, 33.6708970594396, 8550.22242426311, 357.99197593109, 29.8259681517498, 
                          0, 202.216380145835, 0, 252.447876710979, 0, 0, 29.2790339091092, 
                          0, 0, 0, 5027.9288622625, 988.90367469854, 0, 0, 0, 0, 29.3437880000707, 
                          29.3437880000707, 29.3437915252811, 29.3463609408069, 29.3469888910876, 
                          29.3465656712648, 0, 32.4460102150267, 71.3104209210236, 322.800075198847, 
                          0, 36.7628325659775, 9361.28377384076, 414.561244825187, 32.9855553085076, 
                          0, 206.958120264675, 0, 280.698472627974, 0, 0, 32.3429565900994, 
                          0, 0, 0, 5118.64452907885, 1054.491803448, 0, 0, 0, 0, 32.4106562543534, 
                          32.4106562543534, 32.4106649499463, 32.4134981061881, 32.413904185092, 
                          32.4138041402741, 0, 33.7270698201146, 73.4758618826028, 326.698456199421, 
                          0, 38.038406134133, 9019.03993751773, 495.649733388836, 34.3190192836142, 
                          0, 210.439983710358, 0, 320.340180512575, 0, 0, 33.6144681213898, 
                          0, 0, 0, 5405.90319480781, 1701.51053103073, 0, 0, 0, 0, 33.6829862398583, 
                          33.6829862398583, 33.6829997390877, 33.6859396529423, 33.6870484808992, 
                          33.6873568688341, 0, 27.5098252390387, 60.89421236441, 247.38002431377, 
                          0, 31.8165457599884, 6610.02818270993, 506.799820452068, 28.0189096312257, 
                          0, 203.369157006029, 0, 232.51486885617, 0, 0, 27.3980797882599, 
                          0, 0, 0, 5597.46355440878, 2151.88743520324, 0, 0, 0, 0, 27.4536528273247, 
                          27.4536528273247, 27.4537314159327, 27.4560600360231, 27.4582550819707, 
                          27.4589162879652, 0), .Dim = c(31L, 20L))
