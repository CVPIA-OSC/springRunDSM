library(testthat)
library(springRunDSM)

list2env(load_baseline_data(), envir = .GlobalEnv)
mean_egg_temp_effect <- c(0.900631877, 0.879803496, 0.876306213, 0.843355432, 0.846055568, 
                          0.896491346, 0.900631877, 0.7941397695, 0.900685118, 0.900685118, 
                          0.843355432, 0.8098417915, 0.843355432, 0.835920241, 0.843355432, 
                          0, 0, 0.809613829, 0.87965336, 0.884765615, 0, 0, 0.8457998405, 
                          0, 0.8091012, 0.8178536045, 0.8611316565, 0.6133825745, 0.869917628, 
                          0.893724672, 0)

run_model <- function() {
  set.seed(2021)
  seeded_adults <- spring_run_model()
  output <- spring_run_model(seeds = seeded_adults)
  return(output)
}

expected_model_output <- list(spawners = structure(c(36, 77, 465, 0, 50, 7929, 247, 28, 
                                                     0, 604, 0, 479, 0, 0, 37, 0, 0, 0, 8817, 1400, 0, 0, 0, 0, 40, 
                                                     35, 32, 33, 40, 36, 0, 40, 94, 504, 0, 34, 7819, 223, 30, 0, 
                                                     616, 0, 488, 0, 0, 52, 0, 0, 0, 8343, 1358, 0, 0, 0, 0, 30, 36, 
                                                     37, 29, 43, 36, 0, 44, 74, 484, 0, 40, 7918, 238, 45, 0, 621, 
                                                     0, 484, 0, 0, 31, 0, 0, 0, 8826, 1444, 0, 0, 0, 0, 44, 32, 39, 
                                                     26, 35, 37, 0, 45, 72, 472, 0, 42, 7950, 235, 41, 0, 627, 0, 
                                                     499, 0, 0, 38, 0, 0, 0, 7929, 1302, 0, 0, 0, 0, 30, 27, 48, 53, 
                                                     39, 34, 0, 45, 83, 475, 0, 35, 7896, 233, 31, 0, 598, 0, 501, 
                                                     0, 0, 36, 0, 0, 0, 7725, 1260, 0, 0, 0, 0, 37, 48, 30, 26, 43, 
                                                     32, 0, 39, 75, 483, 0, 38, 7864, 236, 38, 0, 619, 0, 499, 0, 
                                                     0, 30, 0, 0, 0, 8440, 1341, 0, 0, 0, 0, 47, 31, 42, 37, 32, 24, 
                                                     0, 46, 74, 490, 0, 37, 7920, 237, 38, 0, 604, 0, 486, 0, 0, 40, 
                                                     0, 0, 0, 8111, 1253, 0, 0, 0, 0, 41, 39, 34, 34, 43, 54, 0, 39, 
                                                     77, 476, 0, 34, 7875, 226, 31, 0, 622, 0, 493, 0, 0, 30, 0, 0, 
                                                     0, 8572, 1337, 0, 0, 0, 0, 42, 49, 39, 38, 29, 38, 0, 34, 65, 
                                                     511, 0, 35, 7908, 238, 41, 0, 618, 0, 504, 0, 0, 38, 0, 0, 0, 
                                                     9784, 1509, 0, 0, 0, 0, 42, 36, 37, 40, 44, 41, 0, 45, 77, 477, 
                                                     0, 36, 7877, 237, 43, 0, 625, 0, 471, 0, 0, 44, 0, 0, 0, 8212, 
                                                     1383, 0, 0, 0, 0, 43, 47, 53, 39, 41, 31, 0, 32, 82, 476, 0, 
                                                     38, 7918, 242, 42, 0, 606, 0, 479, 0, 0, 41, 0, 0, 0, 7614, 1244, 
                                                     0, 0, 0, 0, 34, 33, 31, 31, 35, 34, 0, 46, 74, 485, 0, 38, 7883, 
                                                     252, 48, 0, 607, 0, 493, 0, 0, 36, 0, 0, 0, 9111, 1486, 0, 0, 
                                                     0, 0, 34, 37, 27, 38, 36, 36, 0, 42, 85, 476, 0, 42, 7893, 244, 
                                                     33, 0, 615, 0, 495, 0, 0, 48, 0, 0, 0, 7908, 1273, 0, 0, 0, 0, 
                                                     29, 35, 34, 34, 46, 38, 0, 26, 84, 479, 0, 43, 7920, 248, 34, 
                                                     0, 624, 0, 503, 0, 0, 30, 0, 0, 0, 7835, 1344, 0, 0, 0, 0, 40, 
                                                     41, 33, 29, 36, 27, 0, 27, 89, 480, 0, 34, 7904, 231, 33, 0, 
                                                     594, 0, 490, 0, 0, 47, 0, 0, 0, 8017, 1297, 0, 0, 0, 0, 37, 42, 
                                                     27, 31, 30, 34, 0, 35, 80, 492, 0, 38, 7922, 235, 33, 0, 585, 
                                                     0, 476, 0, 0, 40, 0, 0, 0, 8026, 1290, 0, 0, 0, 0, 45, 39, 29, 
                                                     50, 30, 32, 0, 36, 88, 501, 0, 41, 7856, 242, 31, 0, 641, 0, 
                                                     506, 0, 0, 26, 0, 0, 0, 9865, 1573, 0, 0, 0, 0, 34, 44, 29, 38, 
                                                     41, 44, 0, 32, 70, 494, 0, 51, 7932, 212, 35, 0, 641, 0, 490, 
                                                     0, 0, 50, 0, 0, 0, 10299, 1612, 0, 0, 0, 0, 38, 35, 48, 40, 41, 
                                                     42, 0, 36, 83, 504, 0, 42, 7967, 234, 43, 0, 609, 0, 493, 0, 
                                                     0, 22, 0, 0, 0, 9982, 1583, 0, 0, 0, 0, 29, 37, 38, 32, 43, 35, 
                                                     0, 39, 74, 499, 0, 41, 7884, 232, 27, 0, 592, 0, 516, 0, 0, 42, 
                                                     0, 0, 0, 8001, 1260, 0, 0, 0, 0, 30, 32, 39, 45, 47, 32, 0), 
                                                   .Dim = c(31L, 20L), 
                                                   .Dimnames = list(c("Upper Sacramento River", "Antelope Creek", 
                                                                     "Battle Creek", "Bear Creek", "Big Chico Creek", "Butte Creek", 
                                                                     "Clear Creek", "Cottonwood Creek", "Cow Creek", "Deer Creek", 
                                                                     "Elder Creek", "Mill Creek", "Paynes Creek", "Stony Creek", "Thomes Creek", 
                                                                     "Upper-mid Sacramento River", "Sutter Bypass", "Bear River", 
                                                                     "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                                     "Yolo Bypass", "American River", "Lower Sacramento River", "Calaveras River", 
                                                                     "Cosumnes River", "Mokelumne River", "Merced River", "Stanislaus River", 
                                                                     "Tuolumne River", "San Joaquin River"), c("1", "2", "3", "4", 
                                                                                                               "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", 
                                                                                                               "16", "17", "18", "19", "20"))), 
                              natural_spawners = structure(c(36,  77, 440, 0, 45, 7908, 244, 27, 0, 565, 0, 479, 0, 0, 37, 0, 0, 
                                                             0, 3451, 658, 0, 0, 0, 0, 40, 35, 32, 33, 40, 36, 0, 40, 93, 
                                                             471, 0, 31, 7808, 221, 29, 0, 588, 0, 488, 0, 0, 52, 0, 0, 0, 
                                                             3439, 680, 0, 0, 0, 0, 30, 36, 37, 29, 43, 36, 0, 44, 74, 460, 
                                                             0, 35, 7901, 237, 44, 0, 592, 0, 484, 0, 0, 31, 0, 0, 0, 3438, 
                                                             664, 0, 0, 0, 0, 44, 32, 39, 26, 35, 37, 0, 45, 72, 455, 0, 37, 
                                                             7938, 234, 41, 0, 592, 0, 499, 0, 0, 38, 0, 0, 0, 3379, 662, 
                                                             0, 0, 0, 0, 30, 27, 48, 53, 39, 34, 0, 45, 82, 457, 0, 29, 7885, 
                                                             232, 31, 0, 566, 0, 501, 0, 0, 36, 0, 0, 0, 3444, 632, 0, 0, 
                                                             0, 0, 37, 48, 30, 26, 43, 32, 0, 39, 73, 458, 0, 29, 7844, 232, 
                                                             37, 0, 592, 0, 499, 0, 0, 30, 0, 0, 0, 3493, 642, 0, 0, 0, 0, 
                                                             47, 31, 42, 37, 32, 24, 0, 46, 74, 465, 0, 32, 7905, 234, 38, 
                                                             0, 588, 0, 486, 0, 0, 40, 0, 0, 0, 3437, 657, 0, 0, 0, 0, 41, 
                                                             39, 34, 34, 43, 54, 0, 39, 77, 445, 0, 28, 7860, 224, 31, 0, 
                                                             591, 0, 493, 0, 0, 30, 0, 0, 0, 3498, 640, 0, 0, 0, 0, 42, 49, 
                                                             39, 38, 29, 38, 0, 34, 60, 473, 0, 31, 7889, 234, 40, 0, 576, 
                                                             0, 504, 0, 0, 38, 0, 0, 0, 3400, 654, 0, 0, 0, 0, 42, 36, 37, 
                                                             40, 44, 41, 0, 45, 77, 449, 0, 32, 7855, 237, 43, 0, 587, 0, 
                                                             471, 0, 0, 44, 0, 0, 0, 3424, 680, 0, 0, 0, 0, 43, 47, 53, 39, 
                                                             41, 31, 0, 32, 82, 448, 0, 36, 7899, 242, 42, 0, 579, 0, 479, 
                                                             0, 0, 41, 0, 0, 0, 3499, 645, 0, 0, 0, 0, 34, 33, 31, 31, 35, 
                                                             34, 0, 46, 72, 455, 0, 34, 7861, 250, 48, 0, 574, 0, 493, 0, 
                                                             0, 36, 0, 0, 0, 3435, 678, 0, 0, 0, 0, 34, 37, 27, 38, 36, 36, 
                                                             0, 42, 84, 447, 0, 41, 7881, 242, 32, 0, 589, 0, 495, 0, 0, 48, 
                                                             0, 0, 0, 3382, 670, 0, 0, 0, 0, 29, 35, 34, 34, 46, 38, 0, 26, 
                                                             82, 459, 0, 40, 7908, 244, 34, 0, 594, 0, 503, 0, 0, 30, 0, 0, 
                                                             0, 3447, 679, 0, 0, 0, 0, 40, 41, 33, 29, 36, 27, 0, 27, 89, 
                                                             462, 0, 30, 7883, 229, 32, 0, 571, 0, 490, 0, 0, 47, 0, 0, 0, 
                                                             3441, 640, 0, 0, 0, 0, 37, 42, 27, 31, 30, 34, 0, 35, 79, 468, 
                                                             0, 32, 7914, 234, 33, 0, 561, 0, 476, 0, 0, 40, 0, 0, 0, 3502, 
                                                             639, 0, 0, 0, 0, 45, 39, 29, 50, 30, 32, 0, 36, 86, 462, 0, 39, 
                                                             7836, 239, 28, 0, 591, 0, 506, 0, 0, 26, 0, 0, 0, 3441, 659, 
                                                             0, 0, 0, 0, 34, 44, 29, 38, 41, 44, 0, 32, 69, 465, 0, 46, 7900, 
                                                             212, 35, 0, 591, 0, 490, 0, 0, 50, 0, 0, 0, 3407, 646, 0, 0, 
                                                             0, 0, 38, 35, 48, 40, 41, 42, 0, 36, 82, 474, 0, 36, 7944, 227, 
                                                             43, 0, 569, 0, 493, 0, 0, 22, 0, 0, 0, 3452, 645, 0, 0, 0, 0, 
                                                             29, 37, 38, 32, 43, 35, 0, 39, 74, 475, 0, 37, 7872, 230, 27, 
                                                             0, 570, 0, 516, 0, 0, 42, 0, 0, 0, 3514, 639, 0, 0, 0, 0, 30, 
                                                             32, 39, 45, 47, 32, 0), .Dim = c(31L, 20L), .Dimnames = list(
                                                               c("Upper Sacramento River", "Antelope Creek", "Battle Creek", 
                                                                 "Bear Creek", "Big Chico Creek", "Butte Creek", "Clear Creek", 
                                                                 "Cottonwood Creek", "Cow Creek", "Deer Creek", "Elder Creek", 
                                                                 "Mill Creek", "Paynes Creek", "Stony Creek", "Thomes Creek", 
                                                                 "Upper-mid Sacramento River", "Sutter Bypass", "Bear River", 
                                                                 "Feather River", "Yuba River", "Lower-mid Sacramento River", 
                                                                 "Yolo Bypass", "American River", "Lower Sacramento River", 
                                                                 "Calaveras River", "Cosumnes River", "Mokelumne River", "Merced River", 
                                                                 "Stanislaus River", "Tuolumne River", "San Joaquin River"
                                                               ), c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", 
                                                                    "12", "13", "14", "15", "16", "17", "18", "19", "20"))), 
                              juvenile_biomass = structure(c(1381.6, 659.4, 112600.4, 0, 
                                                             282.6, 2185251.6, 73099.2, 408.2, 0, 143623.6, 0, 536280.6, 
                                                             0, 0, 125.6, 0, 0, 0, 0, 5495, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                             0, 0, 3202.8, 76333.4, 746095.4, 0, 1695.6, 50742996.6, 435319.8, 
                                                             1632.8, 0, 968030.6, 0, 1618607.2, 0, 0, 282.6, 0, 0, 0, 
                                                             537097, 136527.2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8446.6, 
                                                             95832.8, 2069825.2, 0, 5055.4, 65896762.2, 1210880.6, 3862.2, 
                                                             0, 1158251.8, 0, 3357853.2, 0, 0, 2072.4, 0, 0, 0, 586552, 
                                                             236787.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12308.8, 119320, 
                                                             2485153, 0, 5652, 96041829.8, 1418811, 4427.4, 0, 1440349.4, 
                                                             0, 3902706, 0, 0, 2417.8, 0, 0, 0, 8339871.4, 365276.2, 0, 
                                                             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12497.2, 142053.6, 2519253.4, 
                                                             0, 5683.4, 106325926.4, 1476220.2, 4490.2, 0, 1621150.6, 
                                                             0, 3943369, 0, 0, 2449.2, 0, 0, 0, 8802613.2, 376737.2, 0, 
                                                             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14852.2, 176562.2, 2926542.8, 
                                                             0, 6248.6, 114765210.2, 1707082.4, 4867, 0, 1728946.8, 0, 
                                                             4343719, 0, 0, 2512, 0, 0, 0, 8802613.2, 379940, 0, 0, 0, 
                                                             0, 0, 0, 0, 0, 0, 0, 0, 15103.4, 185040.2, 2970251.6, 0, 
                                                             6342.8, 121706839.6, 1761536.7, 4867, 0, 1826820.6, 0, 4519496.2, 
                                                             0, 0, 2512, 0, 0, 0, 8802613.2, 381824, 0, 0, 0, 0, 0, 0, 
                                                             0, 0, 0, 0, 0, 18117.8, 189687.4, 2995528.6, 0, 6374.2, 133377937, 
                                                             1796609.5, 4867, 0, 1981748.2, 0, 4560222, 0, 0, 2543.4, 
                                                             0, 0, 0, 8807888.4, 387476, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                             0, 18149.2, 205607.2, 3052676.6, 0, 6405.6, 140212084.2, 
                                                             1851800.4, 4867, 0, 2142893, 0, 4656525.8, 0, 0, 2543.4, 
                                                             0, 0, 0, 8814953.4, 389705.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                             0, 0, 24209.4, 226802.2, 3067685.8, 0, 6499.8, 146982615, 
                                                             1881750.1, 4898.4, 0, 2229682.6, 0, 4676716, 0, 0, 2543.4, 
                                                             0, 0, 0, 8820950.8, 392468.6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                             0, 0, 25559.6, 250446.4, 3124488.4, 0, 6625.4, 154188538.2, 
                                                             1930054.6, 4961.2, 0, 2345768.4, 0, 4777572.8, 0, 0, 2574.8, 
                                                             0, 0, 0, 8821578.8, 396425, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                             0, 26124.8, 276288.6, 3185718.4, 0, 6688.2, 165302411.2, 
                                                             1976701.7, 5024, 0, 2506410.8, 0, 4991563.8, 0, 0, 2637.6, 
                                                             0, 0, 0, 8822301, 399251, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                             27506.4, 307782.8, 3840879.4, 0, 7002.2, 176039578.4, 2211237.4, 
                                                             6531.2, 0, 2601898.2, 0, 6188971.4, 0, 0, 4647.2, 0, 0, 0, 
                                                             8875900.8, 410241, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 27600.6, 
                                                             315538.6, 3855072.2, 0, 7033.6, 182246416.4, 2229041.2, 6531.2, 
                                                             0, 2689127.4, 0, 6248537.2, 0, 0, 4647.2, 0, 0, 0, 8875963.6, 
                                                             413255.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 29264.8, 327753.2, 
                                                             4794905.6, 0, 10142.2, 186596384, 2790959.4, 9671.2, 0, 2759620.4, 
                                                             0, 7791030.8, 0, 0, 7818.6, 0, 0, 0, 9119690.4, 435361, 0, 
                                                             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 31086, 347880.6, 5397911.2, 
                                                             0, 11052.8, 194952300.8, 3196532.6, 9985.2, 0, 2876962.2, 
                                                             0, 8896813.2, 0, 0, 8792, 0, 0, 0, 9146003.6, 444875.2, 0, 
                                                             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 40725.8, 376046.4, 6968539.2, 
                                                             0, 11366.8, 202399752.8, 3654564.7, 11649.4, 0, 3102696.8, 
                                                             0, 9763421.8, 0, 0, 9137.4, 0, 0, 0, 9146003.6, 468896.2, 
                                                             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 41353.8, 392971, 8223565.8, 
                                                             0, 16799, 206103006, 4330393.5, 14224.2, 0, 3252883, 0, 10791740.4, 
                                                             0, 0, 10613.2, 0, 0, 0, 9146003.6, 493827.8, 0, 0, 0, 0, 
                                                             0, 0, 0, 0, 0, 0, 0, 44179.8, 418530.6, 8843056.4, 0, 18337.6, 
                                                             215785039, 4729032.5, 15605.8, 0, 3441377.2, 0, 11564243.2, 
                                                             0, 0, 10864.4, 0, 0, 0, 13405288, 507047.2, 0, 0, 0, 0, 0, 
                                                             0, 0, 0, 0, 0, 0, 44619.4, 445660.2, 9127760.2, 0, 19750.6, 
                                                             224376141.8, 4955069.9, 15951.2, 0, 3619917.6, 0, 11942267.8, 
                                                             0, 0, 11461, 0, 0, 0, 13410783, 508554.4, 0, 0, 0, 0, 0, 
                                                             0, 0, 0, 0, 0, 0), 
                                                           .Dim = c(31L, 20L), 
                                                           .Dimnames = list(c("Upper Sacramento River", 
                                                                              "Antelope Creek", "Battle Creek", "Bear Creek", "Big Chico Creek", 
                                                                              "Butte Creek", "Clear Creek", "Cottonwood Creek", "Cow Creek", 
                                                                              "Deer Creek", "Elder Creek", "Mill Creek", "Paynes Creek", 
                                                                              "Stony Creek", "Thomes Creek", "Upper-mid Sacramento River", 
                                                                              "Sutter Bypass", "Bear River", "Feather River", "Yuba River", 
                                                                              "Lower-mid Sacramento River", "Yolo Bypass", "American River", 
                                                                              "Lower Sacramento River", "Calaveras River", "Cosumnes River", 
                                                                              "Mokelumne River", "Merced River", "Stanislaus River", "Tuolumne River", 
                                                                              "San Joaquin River"), c("1", "2", "3", "4", "5", "6", "7", 
                                                                                                      "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", 
                                                                                                      "18", "19", "20"))), 
                              viability_metrics = structure(c(0, 0, 
                                                               0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
                                                               0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 
                                                               0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 
                                                               0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), .Dim = c(19L,  4L)))


test_that("The full model results remain the same (with a set seed)", {
  expect_equal(run_model(), expected_model_output)
})
